"use strict";function ErrorLogger(){ErrorLogger.LOCALSTORAGE_PREFIX_KEY="LOGS_TO_KEEP",ErrorLogger.LOCALSTORAGE_INDEX_KEY="LOGS_INDEX",this.nbChunks=10,this.linesInChunks=100}angular.module("uiApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).when("/logs",{templateUrl:"views/product-logs.html",controller:"LogsCtrl"}).otherwise({templateUrl:"views/404.html",controller:"ErrorCtrl"})}]).run(["$rootScope","notificationsService",function(a,b){a.$on("$routeChangeStart",function(){b.stopLoading(),b.removeMessage()})}]),angular.module("uiApp").controller("IndexCtrl",["$scope","pageService",function(a,b){b.setApplicationName("Heroku"),a.page=b}]),angular.module("uiApp").controller("MainCtrl",["$scope","pageService",function(a,b){b.setPageName("Main")}]),angular.module("uiApp").controller("AboutCtrl",["$scope","$http","pageService","apiCallerService",function(a,b,c,d){c.setPageName("About"),d.watchDestroyed(a),d.get(a,"/api/wait/2000",d.API_CONSTANTS.SUCCESS,function(b){a.message=b.message})}]),angular.module("uiApp").controller("ContactCtrl",["$scope","pageService","apiCallerService",function(a,b,c){b.setPageName("Contact"),c.watchDestroyed(a),c.get(a,"/api/expected/to/fail",c.API_CONSTANTS.SUCCESS)}]),angular.module("uiApp").controller("ErrorCtrl",["$scope","pageService",function(a,b){b.setPageName("Error")}]),angular.module("uiApp").controller("NotificationsCtrl",["$scope","notificationsService",function(a,b){a.notifications=b}]),angular.module("uiApp").controller("LogsCtrl",["$scope","pageService","exceptionLogger",function(a,b,c){b.setPageName("Product Logs"),a.content="Nothing to show yet",a.reload=function(){var b=c.getLogs();b||(a.content="Nothing to show yet"),a.content=b},a.clear=function(){c.clearLogs(),a.reload()},a.reload()}]),angular.module("uiApp").service("pageService",function(){this.applicationName=void 0,this.pageName=void 0,this.loading=!1,this.setApplicationName=function(a){this.applicationName=a},this.setPageName=function(a){this.pageName=a},this.getTitle=function(){var a="";return this.pageName&&(a+=this.pageName),this.pageName&&this.applicationName&&(a+=" - "),this.applicationName&&(a+=this.applicationName),a}}),angular.module("uiApp").service("notificationsService",["$timeout",function(a){this.MESAGE_TYPE={NONE:0,INFO:1,ERROR:2},this.message=void 0,this.type=this.MESAGE_TYPE.NONE,this.loading=!1,this.isLoading=function(){return this.loading},this.startLoading=function(){this.loading=!0,this.message=void 0,this.type=this.MESAGE_TYPE.NONE},this.stopLoading=function(){if(this.loading){var b=this;a(function(){b.loading=!1},100)}},this.isInfo=function(){return this.type===this.MESAGE_TYPE.INFO},this.isError=function(){return this.type===this.MESAGE_TYPE.ERROR},this.getMessage=function(){return this.message},this.addInfo=function(a){this.message=a,this.type=this.MESAGE_TYPE.INFO,this.loading=!1},this.addError=function(a){this.message=a,this.type=this.MESAGE_TYPE.ERROR,this.loading=!1},this.removeMessage=function(){this.message=void 0,this.type=this.MESAGE_TYPE.NONE}}]),angular.module("uiApp").service("apiCallerService",["$http","notificationsService","exceptionLogger",function(a,b,c){this.API_CONSTANTS={UNKNOWN:0,SUCCESS:1,PROCESSING:2,ERROR_UNKNOWN:100,ERROR_API_NOT_FOUND:110,ERROR_PARAMETER_MISSING:120,ERROR_PARAMETER_WRONG_VALUE:121},this.watchDestroyed=function(a){a.$on("$destroy",function(){a.destroyed=!0})},this.handleError=function(a){var d="";d=a.result&&a.message?"The following error occurred during the current operation: "+a.message:"An unknown error occurred during the current operation",b.addError(d),c.handleError(d)},this.get=function(d,e,f,g,h){var i=this;b.startLoading();try{a.get(e).success(function(a){if(!d.destroyed){if(!a.result||a.result!==f)return void h(a,200);b.stopLoading(),g&&g(a)}}).error(function(a,c){d.destroyed||(b.stopLoading(),h?h(a,c):i.handleError(a,c))})}catch(j){b.stopLoading(),c.handleError("An unknown error occurred during an API request",j)}}}]),angular.module("uiApp").factory("$exceptionHandler",function(){return function(a){try{console.error("Uncatched exception"+a.stack)}catch(b){console.error("Uncatched exception"+a)}ErrorLogger.getInstance().handleError("Uncatched exception",a,!0)}}).service("exceptionLogger",function(){return ErrorLogger.getInstance()}),ErrorLogger.getInstance=function(){return ErrorLogger.inst||(ErrorLogger.inst=new ErrorLogger),ErrorLogger.inst},ErrorLogger.getInstance.setNbChunks=function(a){this.nbChunks=a},ErrorLogger.getInstance.setLinesInChunks=function(a){this.linesInChunks=a},ErrorLogger.prototype.handleError=function(a,b,c){try{var d=this.formatLine(a);b&&b.stack&&(d+="\n"+b.stack),c||console.error(d),this.addToCurrentChunk(d)}catch(e){console.error(e.stack)}},ErrorLogger.prototype.getLogs=function(){try{var a=this.getLocalStorage();if(a){for(var b=this.getIndex(),c="",d=b.firstChunk;d<=b.currentChunk;d++)c=c?c+"\n"+a.getItem(ErrorLogger.LOCALSTORAGE_PREFIX_KEY+d):a.getItem(ErrorLogger.LOCALSTORAGE_PREFIX_KEY+d);return c}return"Your browser does not support Local storage"}catch(e){console.error(e.stack)}},ErrorLogger.prototype.clearLogs=function(){try{var a=this.getLocalStorage();a&&a.clear()}catch(b){console.error(b.stack)}},ErrorLogger.prototype.getLocalStorage=function(){return"undefined"!=typeof Storage?window.localStorage:void 0},ErrorLogger.prototype.formatLine=function(a){var b=new Date,c=b.getFullYear()+"-"+("00"+b.getDate()).slice(-2)+"-"+("00"+(b.getMonth()+1)).slice(-2)+" "+("00"+b.getHours()).slice(-2)+":"+("00"+b.getMinutes()).slice(-2)+":"+("00"+b.getSeconds()).slice(-2);return c+" | "+a},ErrorLogger.prototype.createIndex=function(){return{firstChunk:0,currentChunk:0}},ErrorLogger.prototype.getIndex=function(){var a,b=this.getLocalStorage();if(b)try{var c=b.getItem(ErrorLogger.LOCALSTORAGE_INDEX_KEY);c&&(a=JSON.parse(c))}catch(d){console.log("Log index cannot be found or is corrupted")}return a||(a=this.createIndex(),this.saveIndex(a)),a},ErrorLogger.prototype.saveIndex=function(a){var b=this.getLocalStorage();if(b)try{b.setItem(ErrorLogger.LOCALSTORAGE_INDEX_KEY,JSON.stringify(a))}catch(c){console.log("Log index cannot be saved")}},ErrorLogger.prototype.countLines=function(a){return a?a.split("\n").length:0},ErrorLogger.prototype.removeOldLogs=function(a){var b=this.getLocalStorage();if(b)try{if(a.currentChunk-a.firstChunk>this.nbChunks){for(var c=a.firstChunk;c<=a.currentChunk-this.nbChunks;c++)b.removeItem(ErrorLogger.LOCALSTORAGE_PREFIX_KEY+c);a.firstChunk=a.currentChunk-this.nbChunks+1}}catch(d){console.log("Could not clear logs")}},ErrorLogger.prototype.addToCurrentChunk=function(a){var b=this.getIndex(),c=this.getLocalStorage();if(c){var d=ErrorLogger.LOCALSTORAGE_PREFIX_KEY+b.currentChunk,e=c.getItem(d),f=this.countLines(e);f>this.linesInChunks&&(b.currentChunk++,this.removeOldLogs(b),this.saveIndex(b),e="",d=ErrorLogger.LOCALSTORAGE_PREFIX_KEY+b.currentChunk),e=e?e+"\n"+a:a,c.setItem(d,e)}};